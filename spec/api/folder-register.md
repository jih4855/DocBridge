# í´ë” ë“±ë¡ API ìŠ¤í™

## 1. ê°œìš”
- **ëª©ì :** ì‚¬ìš©ìê°€ ê´€ë¦¬í•  í”„ë¡œì íŠ¸ í´ë”ë¥¼ ë“±ë¡
- **ë‹´ë‹¹:** Backend
- **ìƒíƒœ:** ğŸ”µ ê²€í† ì¤‘

---

## 2. ì—°ê´€ ìë£Œ
- PRD: [PRD.md](../PRD.md) - ì„¹ì…˜ 7.1
- ë°ì´í„° ëª¨ë¸: í•˜ë‹¨ ì°¸ì¡°

---

## 3. ìš”êµ¬ì‚¬í•­
- ì‚¬ìš©ìê°€ í”„ë¡œì íŠ¸ëª…ê³¼ í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•˜ë©´ ë“±ë¡
- ë“±ë¡ëœ í´ë”ëŠ” ì‚¬ì´ë“œë°”ì— í‘œì‹œë¨
- ê²½ë¡œê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ ê²€ì¦
- ì¤‘ë³µ ë“±ë¡ ë°©ì§€ (ê°™ì€ ê²½ë¡œ)

---

## 4. API ëª…ì„¸

### Endpoint
- **Method:** POST
- **Path:** `/api/folders`
- **ì¸ì¦:** None (ë¡œì»¬ ì „ìš©)

### Request
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| name | string | O | í”„ë¡œì íŠ¸ í‘œì‹œëª… (ì‚¬ì´ë“œë°”ì— í‘œì‹œ) |
| path | string | O | í´ë” ì ˆëŒ€ ê²½ë¡œ (ë„ì»¤ ë‚´ë¶€ ê¸°ì¤€: /data/...) |

### Request ì˜ˆì‹œ
```json
{
  "name": "My Project",
  "path": "/data/my-project/spec"
}
```

### Response (201 Created)
```json
{
  "id": 1,
  "name": "My Project",
  "path": "/data/my-project/spec",
  "created_at": "2025-01-21T12:00:00Z"
}
```

### Error Cases
| ìƒí™© | ì½”ë“œ | ë©”ì‹œì§€ |
|------|------|--------|
| name ëˆ„ë½ | 400 | `{ "error": "name is required" }` |
| path ëˆ„ë½ | 400 | `{ "error": "path is required" }` |
| ê²½ë¡œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ | 400 | `{ "error": "path does not exist" }` |
| ê²½ë¡œê°€ ë””ë ‰í† ë¦¬ê°€ ì•„ë‹˜ | 400 | `{ "error": "path is not a directory" }` |
| ì´ë¯¸ ë“±ë¡ëœ ê²½ë¡œ | 409 | `{ "error": "path already registered" }` |

---

## 5. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

```
1. Request bodyì—ì„œ name, path ì¶”ì¶œ
2. name ë¹ˆ ê°’ ì²´í¬
3. path ë¹ˆ ê°’ ì²´í¬
4. pathê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (os.path.exists)
5. pathê°€ ë””ë ‰í† ë¦¬ì¸ì§€ í™•ì¸ (os.path.isdir)
6. ì´ë¯¸ ë“±ë¡ëœ pathì¸ì§€ í™•ì¸ (DB ì¡°íšŒ)
7. DBì— ì €ì¥
8. ìƒì„±ëœ í´ë” ì •ë³´ ë°˜í™˜
```

---

## 6. ë°ì´í„° ëª¨ë¸

### Folder
| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | int | PK, auto increment |
| name | string | í”„ë¡œì íŠ¸ í‘œì‹œëª… |
| path | string | í´ë” ì ˆëŒ€ ê²½ë¡œ (unique) |
| created_at | datetime | ìƒì„± ì‹œê° |

### ì €ì¥ ë°©ì‹ ì„ íƒ
| ë°©ì‹ | ì¥ì  | ë‹¨ì  |
|------|------|------|
| **SQLite** | ì¿¼ë¦¬ í¸í•¨, í™•ì¥ì„± | íŒŒì¼ í•˜ë‚˜ ë” ìƒê¹€ |
| JSON íŒŒì¼ | ì‹¬í”Œ | ë™ì‹œì„± ì´ìŠˆ, ì¿¼ë¦¬ ë¶ˆí¸ |

**ì¶”ì²œ:** SQLite (í–¥í›„ ê²€ìƒ‰, íƒœê·¸ ë“± í™•ì¥ ê³ ë ¤)

---

## 7. ì—£ì§€ ì¼€ì´ìŠ¤
- [ ] nameì— íŠ¹ìˆ˜ë¬¸ì/ì´ëª¨ì§€ í¬í•¨ â†’ í—ˆìš©
- [ ] name ê¸¸ì´ ì œí•œ â†’ 100ì
- [ ] path ëì— ìŠ¬ë˜ì‹œ ìœ ë¬´ â†’ ì •ê·œí™” (ì œê±°)
- [ ] ì‹¬ë³¼ë¦­ ë§í¬ ê²½ë¡œ â†’ í—ˆìš© (ì‹¤ì œ ê²½ë¡œë¡œ ë³€í™˜í•˜ì§€ ì•ŠìŒ)
- [ ] ìƒìœ„ í´ë”ê°€ ì´ë¯¸ ë“±ë¡ëœ ê²½ìš° â†’ í—ˆìš© (ë³„ê°œë¡œ ë“±ë¡)
- [ ] í•˜ìœ„ í´ë”ê°€ ì´ë¯¸ ë“±ë¡ëœ ê²½ìš° â†’ í—ˆìš© (ë³„ê°œë¡œ ë“±ë¡)

---

## 8. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (TDD - í•„ìˆ˜ êµ¬í˜„)

> ì½”ë”© ì—ì´ì „íŠ¸ëŠ” ì•„ë˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ **ë°˜ë“œì‹œ** êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
> í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± í›„ êµ¬í˜„ ì½”ë“œë¥¼ ì‘ì„±í•˜ì‹­ì‹œì˜¤.

### Unit Tests (Service Layer)
| í…ŒìŠ¤íŠ¸ëª… | ì…ë ¥ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|------|-----------|
| `test_normalize_path_removes_trailing_slash` | `/data/project/` | `/data/project` |
| `test_validate_name_length` | 101ì ì´ìƒ | ValidationError |

### Integration Tests (API)
| í…ŒìŠ¤íŠ¸ëª… | ìš”ì²­ | ê¸°ëŒ€ ì‘ë‹µ |
|----------|------|-----------|
| `test_register_folder_success` | `{"name": "Test", "path": "/data/test"}` | 201, í´ë” ì •ë³´ ë°˜í™˜ |
| `test_register_folder_missing_name` | `{"path": "/data/test"}` | 400, `name is required` |
| `test_register_folder_missing_path` | `{"name": "Test"}` | 400, `path is required` |
| `test_register_folder_path_not_exist` | `{"name": "Test", "path": "/invalid"}` | 400, `path does not exist` |
| `test_register_folder_path_not_directory` | `{"name": "Test", "path": "/data/file.txt"}` | 400, `path is not a directory` |
| `test_register_folder_duplicate_path` | ë™ì¼ ê²½ë¡œ 2íšŒ ë“±ë¡ | 409, `path already registered` |

### Edge Case Tests
| í…ŒìŠ¤íŠ¸ëª… | ìƒí™© | ê¸°ëŒ€ ê²°ê³¼ |
|----------|------|-----------|
| `test_name_with_special_chars` | `{"name": "í”„ë¡œì íŠ¸!@#"}` | 201, í—ˆìš© |
| `test_name_with_emoji` | `{"name": "My Project ğŸš€"}` | 201, í—ˆìš© |
| `test_path_trailing_slash_normalized` | `{"path": "/data/test/"}` | ì €ì¥ ì‹œ `/data/test` |

---

## 9. ì°¸ê³  (ì˜ì‚¬ì½”ë“œ)

```python
@app.post("/api/folders")
def register_folder(body: FolderCreate):
    # ìœ íš¨ì„± ê²€ì‚¬
    if not body.name:
        raise HTTPException(400, "name is required")
    if not body.path:
        raise HTTPException(400, "path is required")

    # ê²½ë¡œ ì •ê·œí™” (ë ìŠ¬ë˜ì‹œ ì œê±°)
    path = body.path.rstrip("/")

    # ê²½ë¡œ ì¡´ì¬ í™•ì¸
    if not os.path.exists(path):
        raise HTTPException(400, "path does not exist")
    if not os.path.isdir(path):
        raise HTTPException(400, "path is not a directory")

    # ì¤‘ë³µ ì²´í¬
    if db.folder_exists(path):
        raise HTTPException(409, "path already registered")

    # ì €ì¥
    folder = db.create_folder(name=body.name, path=path)

    return folder
```

---

## 10. í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

### UI íë¦„
```
1. [+ í´ë” ë“±ë¡] ë²„íŠ¼ í´ë¦­
2. ëª¨ë‹¬ ì—´ë¦¼
   - í”„ë¡œì íŠ¸ëª… ì…ë ¥
   - ê²½ë¡œ ì…ë ¥
3. [ë“±ë¡] ë²„íŠ¼ í´ë¦­
4. API í˜¸ì¶œ
5. ì„±ê³µ â†’ ëª¨ë‹¬ ë‹«ê¸°, ì‚¬ì´ë“œë°” ìƒˆë¡œê³ ì¹¨
   ì‹¤íŒ¨ â†’ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
```

### ëª¨ë‹¬ ì™€ì´ì–´í”„ë ˆì„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í´ë” ë“±ë¡                    [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  í”„ë¡œì íŠ¸ëª…                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ My Project                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  ê²½ë¡œ                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /data/my-project/spec      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  âš ï¸ /data/ í•˜ìœ„ ê²½ë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥   â”‚
â”‚                                  â”‚
â”‚         [ì·¨ì†Œ]  [ë“±ë¡]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. êµ¬í˜„ ê²°ê³¼ (ì½”ë”© ì—ì´ì „íŠ¸ê°€ ì‘ì„±)

### ìƒì„±ëœ íŒŒì¼
| íŒŒì¼ ê²½ë¡œ | ì„¤ëª… |
|-----------|------|
| app/schemas/folder.py | Pydantic ìŠ¤í‚¤ë§ˆ (FolderCreate, FolderResponse) |
| app/db/database.py | SQLite DB ì„¤ì • ë° ì´ˆê¸°í™” |
| app/repositories/folder_repository.py | ë°ì´í„° ì ‘ê·¼ ë ˆì´ì–´ (CRUD) |
| app/services/folder_service.py | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë° ì»¤ìŠ¤í…€ ì˜ˆì™¸ |
| app/api/folders.py | API ë¼ìš°í„° (POST /api/folders) |
| app/core/config.py | í™˜ê²½ ì„¤ì • |
| tests/test_folder_register.py | TDD í…ŒìŠ¤íŠ¸ ì½”ë“œ (13ê°œ) |
| tests/conftest.py | í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜ |

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
- ì´ 13ê°œ / í†µê³¼ 13ê°œ / ì‹¤íŒ¨ 0ê°œ

### íŠ¹ì´ì‚¬í•­
- SQLite ì‚¬ìš© (ëª…ì„¸ ê¶Œì¥ ì‚¬í•­ ì¤€ìˆ˜)
- ë ˆì´ì–´ ë¶„ë¦¬: Router â†’ Service â†’ Repository
- path ë ìŠ¬ë˜ì‹œ ì •ê·œí™” êµ¬í˜„
- name 100ì ì œí•œ êµ¬í˜„

---

## ë³€ê²½ ì´ë ¥
| ë‚ ì§œ | ì‘ì—…ì | ë‚´ìš© |
|------|--------|------|
| 2025-01-21 | - | ì´ˆì•ˆ ì‘ì„± |
| 2025-01-21 | AI | TDD ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ì™„ë£Œ |
